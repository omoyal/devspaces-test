schemaVersion: 2.1.0
metadata:
  name: organizational-devfile
  version: 1.0.0
  description: |
    A Devfile for organizational needs. This will configure organizational certificates, 
    PIP, and provide an IDE automatically.

components:
  - name: tools-container
    container:
      image: registry.redhat.io/ubi8/python-39   # תוודא שזה image זמין בסביבה שלך
      memoryLimit: 2Gi
      mountSources: true
      volumes:
        - name: org-certs-volume
          mountPath: /etc/ssl/certs  # כאן נטמיע את ה-CERTIFICATES הארגוניים
      env:
        - name: PIP_CONFIG_FILE
          value: /workspace/.pip/pip.conf  # הגדרת קובץ ה-PIP

  - name: org-certs-volume
    volume:
      size: 1Gi  # Volume לאחסון CERTIFICATES ארגוניים

  - name: python-settings
    kubernetes:
      inlined: |
        apiVersion: v1
        kind: ConfigMap
        metadata:
          name: python-pip-config
        data:
          pip.conf: |
            [global]
            # יש להחליף בכתובת הריפוזיטורי של הארגון
            index-url = http://your-org-pip-repository/simple
            trusted-host = your-org-pip-repository

commands:
  - id: configure-certificates
    exec:
      component: tools-container
      commandLine: |
        echo "Configuring certificates" && \
        cp /workspace/org-certificates/organization-certs.pem /etc/ssl/certs/
      workingDir: /workspace
      group:
        kind: build
        isDefault: true

  - id: start-ide
    exec:
      component: tools-container
      commandLine: "code-server --bind-addr 0.0.0.0:3000"  # הפעלת IDE
      group:
        kind: run
        isDefault: true

